<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Macronutrient Distribution by Food Category</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .title {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .boxplot {
            margin: 20px 0;
        }
        .axis {
            font-size: 12px;
        }
        .axis-label {
            font-size: 14px;
            font-weight: bold;
        }
        .tooltip {
            position: absolute;
            padding: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 4px;
            pointer-events: none;
            font-size: 12px;
        }
        .legend {
            margin-top: 20px;
        }
        .category-label {
            font-size: 12px;
            text-anchor: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">Macronutrient Distribution by Food Category</h1>
        <div class="chart-container">
            <div id="chart"></div>
            <div class="legend" id="legend"></div>
        </div>
    </div>

    <script>
        // Set dimensions and margins
        const margin = { top: 50, right: 80, bottom: 100, left: 80 };
        const width = 1000 - margin.left - margin.right;
        const height = 500 - margin.top - margin.bottom;

        // Create SVG
        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Create tooltip
        const tooltip = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // Load and process data
        d3.csv("fastfood.csv").then(function(data) {
            // Data preprocessing
            data.forEach(d => {
                d.calories = +d.calories;
                d.total_fat = +d.total_fat;
                d.total_carb = +d.total_carb;
                d.protein = +d.protein;
                
                // Create food categories based on item names
                d.category = categorizeFood(d.item);
            });

            // Define macronutrients to analyze
            const nutrients = [
                { key: 'total_fat', name: 'Total Fat (g)', color: '#FF9A8B' },
                { key: 'total_carb', name: 'Total Carbohydrates (g)', color: '#8BC6EC' },
                { key: 'protein', name: 'Protein (g)', color: '#7BE495' }
            ];

            // Create box plots for each nutrient
            nutrients.forEach((nutrient, index) => {
                createBoxPlot(data, nutrient, index, nutrients.length);
            });

            // Create legend
            createLegend(nutrients);
        });

        // Food categorization function
        function categorizeFood(itemName) {
            const name = itemName.toLowerCase();
            
            if (name.includes('burger') || name.includes('cheeseburger')) {
                return 'Burgers';
            } else if (name.includes('chicken') && (name.includes('sandwich') || name.includes('wrap'))) {
                return 'Chicken Sandwiches';
            } else if (name.includes('salad')) {
                return 'Salads';
            } else if (name.includes('nugget') || name.includes('tender') || name.includes('strip')) {
                return 'Chicken Pieces';
            } else if (name.includes('taco') || name.includes('burrito') || name.includes('quesadilla')) {
                return 'Mexican Food';
            } else if (name.includes('dog') || name.includes('frank')) {
                return 'Hot Dogs';
            } else if (name.includes('pizza')) {
                return 'Pizza';
            } else {
                return 'Other';
            }
        }

        // Create box plot function
        function createBoxPlot(data, nutrient, plotIndex, totalPlots) {
            // Calculate position for each plot
            const plotWidth = width / totalPlots;
            const plotX = plotIndex * plotWidth;
            
            // Group data by category
            const categories = Array.from(new Set(data.map(d => d.category))).sort();
            
            // Calculate statistics for each category
            const categoryStats = categories.map(category => {
                const values = data
                    .filter(d => d.category === category && !isNaN(d[nutrient.key]))
                    .map(d => d[nutrient.key])
                    .sort(d3.ascending);
                
                if (values.length === 0) return null;
                
                return {
                    category: category,
                    values: values,
                    min: d3.min(values),
                    q1: d3.quantile(values, 0.25),
                    median: d3.quantile(values, 0.5),
                    q3: d3.quantile(values, 0.75),
                    max: d3.max(values)
                };
            }).filter(d => d !== null);

            // Create scales
            const xScale = d3.scaleBand()
                .domain(categories)
                .range([0, plotWidth - 50])
                .padding(0.3);

            const allValues = categoryStats.flatMap(d => d.values);
            const yScale = d3.scaleLinear()
                .domain([0, d3.max(allValues) * 1.1])
                .range([height, 0])
                .nice();

            // Create subplot container
            const plotGroup = svg.append("g")
                .attr("transform", `translate(${plotX}, 0)`);

            // Add Y axis
            if (plotIndex === 0) {
                plotGroup.append("g")
                    .attr("class", "axis")
                    .call(d3.axisLeft(yScale));
                
                plotGroup.append("text")
                    .attr("class", "axis-label")
                    .attr("transform", "rotate(-90)")
                    .attr("y", -50)
                    .attr("x", -height / 2)
                    .attr("text-anchor", "middle")
                    .text("Grams (g)");
            }

            // Add X axis
            const xAxisGroup = plotGroup.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(xScale))
                .selectAll("text")
                .attr("transform", "rotate(-45)")
                .style("text-anchor", "end");

            // Draw box plots
            plotGroup.selectAll(".box")
                .data(categoryStats)
                .enter()
                .append("g")
                .attr("class", "box")
                .attr("transform", d => `translate(${xScale(d.category) + xScale.bandwidth()/2},0)`)  
                .each(function(d) {
                    const boxGroup = d3.select(this);
                    
                    // Draw box
                    boxGroup.append("rect")
                        .attr("x", -xScale.bandwidth()/2)
                        .attr("y", yScale(d.q3))
                        .attr("width", xScale.bandwidth())
                        .attr("height", yScale(d.q1) - yScale(d.q3))
                        .attr("fill", nutrient.color)
                        .attr("opacity", .7)
                        .attr("stroke", "#333")
                        .on("mouseover", function(event) {
                            tooltip.transition()
                                .duration(200)
                                .style("opacity", .9);
                            tooltip.html(`
                                <strong>${d.category}</strong><br/>
                                ${nutrient.name}<br/>
                                Min: ${d.min.toFixed(1)}g<br/>
                                Q1: ${d.q1.toFixed(1)}g<br/>
                                Median: ${d.median.toFixed(1)}g<br/>
                                Q3: ${d.q3.toFixed(1)}g<br/>
                                Max: ${d.max.toFixed(1)}g
                            `)
                                .style("left", (event.pageX + 10) + "px")
                                .style("top", (event.pageY - 28) + "px");
                        })
                        .on("mouseout", function() {
                            tooltip.transition()
                                .duration(500)
                                .style("opacity", 0);
                        });

                    // Draw median line
                    boxGroup.append("line")
                        .attr("x1", -xScale.bandwidth()/2)
                        .attr("x2", xScale.bandwidth()/2)
                        .attr("y1", yScale(d.median))
                        .attr("y2", yScale(d.median))
                        .attr("stroke", "#333")
                        .attr("stroke-width", 2);

                    // Draw upper whisker
                    boxGroup.append("line")
                        .attr("x1", 0)
                        .attr("x2", 0)
                        .attr("y1", yScale(d.max))
                        .attr("y2", yScale(d.q3))
                        .attr("stroke", "#333");

                    // Draw lower whisker
                    boxGroup.append("line")
                        .attr("x1", 0)
                        .attr("x2", 0)
                        .attr("y1", yScale(d.min))
                        .attr("y2", yScale(d.q1))
                        .attr("stroke", "#333");

                    // Draw upper whisker cap
                    boxGroup.append("line")
                        .attr("x1", -xScale.bandwidth()/4)
                        .attr("x2", xScale.bandwidth()/4)
                        .attr("y1", yScale(d.max))
                        .attr("y2", yScale(d.max))
                        .attr("stroke", "#333");

                    // Draw lower whisker cap
                    boxGroup.append("line")
                        .attr("x1", -xScale.bandwidth()/4)
                        .attr("x2", xScale.bandwidth()/4)
                        .attr("y1", yScale(d.min))
                        .attr("y2", yScale(d.min))
                        .attr("stroke", "#333");
                });

            // Add nutrient title
            plotGroup.append("text")
                .attr("class", "axis-label")
                .attr("x", plotWidth / 2 - 25)
                .attr("y", -20)
                .attr("text-anchor", "middle")
                .text(nutrient.name)
                .style("fill", nutrient.color);
        }

        // Create legend function
        function createLegend(nutrients) {
            const legend = d3.select("#legend");
            
            nutrients.forEach((nutrient, i) => {
                const legendItem = legend.append("div")
                    .style("display", "inline-block")
                    .style("margin", "0 20px");
                
                legendItem.append("div")
                    .style("display", "inline-block")
                    .style("width", "20px")
                    .style("height", "20px")
                    .style("background-color", nutrient.color)
                    .style("margin-right", "5px")
                    .style("vertical-align", "middle");
                
                legendItem.append("span")
                    .style("vertical-align", "middle")
                    .text(nutrient.name);
            });
        }
    </script>
</body>
</html>